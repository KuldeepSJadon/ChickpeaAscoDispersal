---
title: "Visualise Data"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output:
  html_document:
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 4.7, fig.height = 4.7)
```

See "R/wrangle_raw_data.R" for the script that handles the data import. This
Rmd file focuses on the data.

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, clifro, skimr, devtools, extrafont, ggpubr)

if (!require("theme.usq"))
   devtools::install_github("adamhsparks/theme.usq")
library(theme.usq)

theme_set(theme_pubclean())
```

```{r fonts, include=FALSE, echo=FALSE, message=FALSE, eval=FALSE}
# run only if knitting on new computer
# this is necessary to embed fonts in .eps files for EJPP
font_import(pattern = "Arial")
loadfonts(device = "postscript") 
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
skim(dat)
```

## Visualise Counts per Pot

```{r lesion-count}
ggplot(dat, aes(x = mean_count_pot)) +
   geom_density() +
   xlab("Mean lesion count per pot")
```

## Visualise the Dispersal Data

<<<<<<< HEAD
```{r comined-dispersal}
ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count(alpha = 0.5,
              aes(colour = ptype)) +
   scale_size_continuous(range = c(3, 12)) +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   labs(main = "Dispersal by event", 
        caption = "Line shows median lesion count values") +
   facet_grid(. ~ ptype)
```
=======
```{r combined-dispersal, message=FALSE}
facet_labs <- c("Rainfall", "Irrigation")
names(facet_labs) <- c("rain", "simRain")
>>>>>>> 3a45febd1f17b8f083d413df4a656238bfd507b2

ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count() +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   facet_grid(. ~ ptype,
              labeller = labeller(ptype = facet_labs))

# save a .png to refer to while writing and a .eps for publication submission
ggsave("figures/Fig1.png")
ggsave("figures/Fig1.eps")
embed_fonts("figures/Fig1.eps", outfile = "figures/Fig1.eps",
            options = "-dEPSCrop")
```

## Visualise the Windspeed and Direction

```{r wind, message=FALSE}
pw <-
   with(dat, windrose(mws, mwd, SpEv, n_col = 3, col_pal = "YlOrRd"))
pw + 
   xlab("") + 
   theme_pubclean()

# save a .png to refer to while writign and a .eps for publication submission
ggsave("figures/Fig2.png")
ggsave("figures/Fig2.eps")
embed_fonts("figures/Fig2.eps", outfile = "figures/Fig2.eps",
            options = "-dEPSCrop")
```

## Visualise the Rainfall and Irrigation Events
```{r rain, message=FALSE}
ggplot(data = distinct(dat, SpEv, .keep_all = TRUE),
       aes(
          x = SpEv,
          y = sum_rain
       )) +
   geom_bar(stat = "identity") +
   scale_colour_usq() +
   ylab("Total precipitation in event (mm)") +
   xlab("Event") +
   labs(main = "Rainfall events") +
   theme(legend.position = "none") +
   coord_flip()

# save a .png to refer to while writing and a .eps for publication submission
ggsave("figures/Fig3.png")
ggsave("figures/Fig3.eps")
embed_fonts("figures/Fig3.eps", outfile = "figures/Fig3.eps",
            options = "-dEPSCrop")
```

## Heatmap of Lesions Along Transects

```{r polar_coord_transects, message = FALSE, eval=TRUE}
ggplot(dat,
       aes(
          x = transect,
          y = dist,
          colour = mean_count_pot,
          size = mean_count_pot
       )) +
   geom_count() +
   # coord_polar(start = 3.5 * pi * max(dat$direction) / diff(range(dat$direction))) +
   scale_colour_viridis_c(
      option = "plasma",
      direction = -1
   ) +
   scale_size_continuous(name = "n") +
   guides(color = FALSE) +
   ylab("Distance (m)") +
   xlab("Transect") +
   facet_wrap(. ~ SpEv, ncol = 3)

ggsave("figures/Fig4.png")
ggsave("figures/Fig4.eps")
embed_fonts("figures/Fig4.eps", outfile = "figures/Fig4.eps",
            options = "-dEPSCrop")
```

