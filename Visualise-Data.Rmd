---
title: "Visualise Data"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output:
  html_document:
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 12, fig.height = 9)
```

See "R/wrangle_raw_data.R" for the script that handles the data import. This
Rmd file focuses on the data.

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, clifro, skimr, devtools, extrafont, ggpubr)

if (!require("theme.usq"))
   devtools::install_github("adamhsparks/theme.usq")
library(theme.usq)

theme_set(theme_pubclean())
```

```{r fonts, include=FALSE, echo=FALSE, message=FALSE, eval=FALSE}
# run only if knitting on new computer
# this is necessary to embed fonts in .eps files for EJPP
font_import(pattern = "Arial")
loadfonts(device = "postscript") 
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
skim(dat)
```

## Visualise Counts per Pot

```{r lesion-count}
ggplot(dat, aes(x = mean_count_pot)) +
   geom_density() +
   xlab("Mean lesion count per pot")
```

## Visualise the Dispersal Data

```{r conbined-dispersal, message=FALSE}
facet_labs <- c("Rainfall", "Irrigation")
names(facet_labs) <- c("rain", "simRain")

ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count() +
   scale_size_continuous(range = c(3, 12)) +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   facet_grid(. ~ ptype,
              labeller = labeller(ptype = facet_labs))

# save a .png to refer to while writing and a .eps for publication submission
ggsave("figures/Fig1.png")
ggsave("figures/Fig1.eps")
embed_fonts("figures/Fig1.eps", outfile = "figures/Fig1.eps",
            options = "-dEPSCrop")
```

```{r facet-dispersal}
ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count(alpha = 0.5,
              aes(colour = SpEv)) +
   scale_size_continuous(range = c(3, 12)) +
   scale_colour_usq("bright") +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   labs(main = "Dispersal for all events",
        caption = "Line shows median lesion count values") +
   theme_usq(base_size = 15) +
   facet_wrap(SpEv ~ .)
```

## Visualise the Windspeed and Direction

```{r wind, message=FALSE}
pw <-
   with(dat, windrose(mws, mwd, SpEv, n_col = 3, col_pal = "YlOrRd"))

pw + 
   xlab("") + 
   theme_pubclean()

# save a .png to refer to while writign and a .eps for publication submission
ggsave("figures/Fig2.png")
ggsave("figures/Fig2.eps")
embed_fonts("figures/Fig2.eps", outfile = "figures/Fig2.eps",
            options = "-dEPSCrop")
```

## Visualise the Rainfall and Irrigation Events
```{r rain, message=FALSE}
ggplot(data =  distinct(dat, SpEv, .keep_all = TRUE),
       aes(
          x = SpEv,
          y = sum_rain
       )) +
   geom_bar(stat = "identity") +
   scale_colour_usq("bright") +
   ylab("Total precipitation in event (mm)") +
   xlab("Event") +
   labs(main = "Rainfall events") +
   theme(legend.position = "none")

# save a .png to refer to while writing and a .eps for publication submission
ggsave("figures/Fi3.png")
ggsave("figures/Fig3.eps")
embed_fonts("figures/Fig3.eps", outfile = "figures/Fig3.eps",
            options = "-dEPSCrop")
```
