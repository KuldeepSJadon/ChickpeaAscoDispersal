---
title: "Visualise Data"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 12, fig.height = 9)
```

See "R/wrangle_raw_data.R" for the script that handles the data import. This
Rmd file focuses on the data.

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, clifro, skimr, devtools)

if (!require("theme.usq")) devtools::install_github("adamhsparks/theme.usq")
theme_set(theme_usq(base_size = 15))
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
skim(dat)
```

## Visualise Counts per Pot

```{r lesion-count}
ggplot(dat, aes(x = mean_count_pot)) +
   geom_density() +
   xlab("Mean lesion count per pot")
```

## Visualise the Dispersal Data

```{r conbined-dispersal}
ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count(alpha = 0.5) +
   scale_size_continuous(range = c(3, 12)) +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   labs(main = "Dispersal by event", 
        caption = "Line shows median lesion count values")
```

```{r facet-dispersal}
ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count(alpha = 0.5,
              aes(colour = SpEv)) +
   scale_size_continuous(range = c(3, 12)) +
   scale_colour_usq("bright") +
   stat_summary(fun.y = "median",
                geom = "line",
                na.rm = TRUE) +
   ylim(c(-0.5, 9)) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   labs(main = "Dispersal for all events",
        caption = "Line shows median lesion count values") +
   theme_usq(base_size = 15) +
   facet_wrap(SpEv ~ .)
```

## Visualise the Windspeed and Direction

```{r wind}
pw <-
   with(dat, windrose(mws, mwd, SpEv, n_col = 3, col_pal = "YlOrRd"))
pw + theme_usq(base_size = 15) +
   labs(caption = "Mean windspeed and mean direction for each event.")
```

## Visualise the Rainfall and Irrigation Events
```{r rain}
ggplot(dat, aes(
   x = SpEv,
   y = sum_rain/100,
   colour = SpEv,
   fill = SpEv
)) +
   geom_bar(stat = "identity") +
   scale_fill_usq("bright") +
   scale_colour_usq("bright") +
   ylab("Total precipitation in event (mm)") +
   xlab("Event") +
   labs(main = "Rainfall events") +
   theme(legend.position = "none")
```

