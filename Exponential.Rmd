---
title: "Fit Exponential Decay Models to dispersal patterns of _Ascochyta_ conidia"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 12, fig.height = 9) 
```

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, broom, nlstools, devtools)

if (!require("theme.usq")) devtools::install_github("adamhsparks/theme.usq")
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
```

## Visualise Fit Non-linear Model

The data appear to behave like an exponential decay model. This may be useful in
the absence of more data to fit a GAM, which would be the ideal situation.

```{r vis_mod_dist}
ggplot(dat, aes(x = dist, y = mean_count_pot)) +
   geom_count() +
   stat_smooth(
      method = "nls",
      formula = y ~ SSasymp(x, Asym, R0, lrc),
      se = FALSE,
      colour = usq_cols("usq yellow")
   ) +
   ylab("Mean lesion count values") +
   xlab("Distance (m)") +
   theme_usq(base_size = 15)
```

## Model

```{r fit_mod}
mod1 <- nls(mean_count_pot ~ SSasymp(dist, Asym, R0, lrc), data = dat)

summary(mod1)
glance(mod1)
RSS.p <- sum(residuals(mod1)^2)
TSS <- sum((dat$mean_count_pot - mean(dat$mean_count_pot))^2)
r2 <- 1 - (RSS.p/TSS)
paste("R2:", r2)


mod1_res <- nlsResiduals(mod1)
plot(mod1_res)
test.nlsResiduals(mod1_res)
```

## Thoughts

The diagnostic plots don't look so great for this data. Better starting values
might help if we optimised the nls. 

The R^2^ value is also roughly the same as the GAMs we've been looking at.

While this model may have some utility, maybe best to focus on GAMs for the time
being.
