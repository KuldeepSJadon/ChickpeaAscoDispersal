---
title: "Fit GAMs to dispersal patterns of _Ascochyta_ conidia"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 12, fig.height = 9) 
```

## Import Data

See "R/wrangle_raw_data.R" for the script that handles the data import. This
Rmd file focuses on the models themselves.

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, broom, skimr, devtools, mgcv)
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
```

## Fit GAMs

### mod1 - s(Distance)

```{r fit-mod1, echo=FALSE}
mod1 <-
   gam(
      mean_count_pot ~ s(dist, k = 5),
      data = dat
   )

summary(mod1)
```

### mod2 - s(Distance) plus Precipitation

```{r fit-mod2, echo=FALSE}
mod2 <-
   gam(
      mean_count_pot ~ sum_rain+ s(dist, k = 5),
      data = dat
   )

summary(mod2)
```

### mod3 - s(Distance) Windspeed
```{r fit-mod3, echo=FALSE}
mod3 <-
   gam(mean_count_pot ~ mws + s(dist, k = 5),
       data = dat)

summary(mod3)
```

### mod4 - s(Distance) Windspeed plus Precipitation
```{r fit-mod4, echo=FALSE}
mod4 <-
   gam(mean_count_pot ~ sum_rain + mws + s(dist, k = 5),
       data = dat)

summary(mod4)
```

### mod5 - s(Distance + Windspeed) plus Precipitation

```{r fit-mod5, echo=FALSE}
mod5 <-
   gam(
      mean_count_pot ~ sum_rain + s(dist + mws, k = 5),
      data = dat
   )

summary(mod5)
```

### mod6 - s(Distance) + s(Windspeed) plus Precipitation

```{r fit-mod6, echo=FALSE}
mod6 <-
   gam(
      mean_count_pot ~ sum_rain + s(dist, k = 5) + s(mws, k = 5),
      data = dat
   )

summary(mod6)
```

### mod7 - s(Distance) + s(Windspeed)

```{r fit-mod7, echo=FALSE}
mod7 <-
   gam(
      mean_count_pot ~ s(dist, k = 5) + s(mws, k = 5),
      data = dat
   )

summary(mod7)
```

### mod8 - s(Distance) + s(Windspeed) +s(Precipitation)

```{r fit-mod8, echo=FALSE}
mod8 <-
   gam(
      mean_count_pot ~ s(dist, k = 5) + s(mws, k = 5) + s(sum_rain, k = 5),
      data = dat
   )

summary(mod8)
```

### mod9 - s(Distance) +s(Precipitation)

```{r fit-mod9, echo=FALSE}
mod9 <-
   gam(
      mean_count_pot ~ s(dist, k = 5) + s(sum_rain, k = 5),
      data = dat
   )

summary(mod9)
```

### mod10 - s(Distance) +s(Precipitation) + Windspeed

```{r fit-mod10, echo=FALSE}
mod10 <-
   gam(
      mean_count_pot ~ s(dist, k = 5) + s(sum_rain, k = 5) + mws,
      data = dat
   )

summary(mod10)
```

### mod11 - s(Distance) + s(Windspeed) +s(Precipitation) - Family = tw()

```{r fit-mod11, echo=FALSE}
mod11 <-
   gam(
      mean_count_pot ~ s(dist, k = 5) + s(mws, k = 5) + s(sum_rain, k = 5),
      data = dat,
      family = tw()
   )

summary(mod11)
```

## Compare the Models

### AIC, BIC
```{r compare-mods, echo=FALSE}
models <- list(mod1 = mod1,
               mod2 = mod2,
               mod3 = mod3,
               mod4 = mod4,
               mod5 = mod5,
               mod6 = mod6,
               mod7 = mod7,
               mod8 = mod8,
               mod9 = mod9,
               mod10 = mod10,
               mod11 = mod11
               )
map_df(models, glance, .id = "model") %>%
   arrange(AIC)
```

### R^2^
```{r r2, echo=FALSE}
enframe(c(
   mod1 = summary(mod1)$r.sq,
   mod2 = summary(mod2)$r.sq,
   mod3 = summary(mod3)$r.sq,
   mod4 = summary(mod4)$r.sq,
   mod5 = summary(mod5)$r.sq,
   mod6 = summary(mod6)$r.sq,
   mod7 = summary(mod7)$r.sq,
   mod8 = summary(mod8)$r.sq,
   mod9 = summary(mod9)$r.sq,
   mod10 = summary(mod10)$r.sq,
   mod11 = summary(mod11)$r.sq
)) %>%
   arrange(desc(value))
```

### Coefficients

```{r coef, echo=FALSE}
cat("\nmod1\n")
coef(mod1)
cat("\nmod2\n")
coef(mod2)
cat("\nmod3\n")
coef(mod3)
cat("\nmod4\n")
coef(mod4)
cat("\nmod5\n")
coef(mod5)
cat("\nmod6\n")
coef(mod6)
cat("\nmod7\n")
coef(mod7)
cat("\nmod8\n")
coef(mod8)
cat("\nmod9\n")
coef(mod9)
cat("\nmod10\n")
coef(mod10)
cat("\nmod11\n")
coef(mod11)
```

### ANOVA
```{r anova, echo=FALSE}
anova(mod1,
      mod2,
      mod3,
      mod4,
      mod5,
      mod6,
      mod7,
      mod8,
      mod9,
      mod10,
      mod11,
      test = "F")
```

### Visualise the Models

```{r vis-mods, echo=FALSE}
par(mfrow = c(2, 2))
plot(mod1, main = "s(Distance)")
plot(mod2, main = "s(Distance) + Precipitation")
plot(mod3, main = "s(Distance) + Windspeed")
plot(mod4, main = "s(Distance) + Windspeed + Precipitation")
plot(mod5, main = "s(Distance + Windspeed) + Precipitation")
plot(mod6, main = "s(Distance) + s(Windspeed) + Precipitation")
plot(mod7, main = "s(Distance) + s(Windspeed)")
plot(mod8, main = "s(Distance) + s(Windspeed) + s(Precipitation)")
plot(mod9, main = "s(Distance) + s(Precipitation)")
plot(mod10, main = "s(Distance) + s(Precipitation) + Windspeed")
plot(mod8, main = "s(Distance) + s(Windspeed) + s(Precipitation) - family = tw()")
```
