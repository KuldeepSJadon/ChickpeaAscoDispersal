---
title: "Fit GAMs to dispersal patterns of _Ascochyta_ conidia"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output: github_document
---
   
## Load Libraries and Import Data

```{r libraries, message=FALSE}
library("tidyverse")
library("mgcv")
```

```{r import data, message=FALSE}
dat <-
   read_csv("data/CPSporesSpatial version 2.csv") %>%
   group_by(site, rep, transect, distance, station, mat, mah, mws, mwd) %>%
   drop_na(dist_stat) 

dat$rainfall <- dat$mrain + dat$precip

dbl <-
   c(
      "counts_p1",
      "counts_p2",
      "counts_p3",
      "counts_p4",
      "counts_p5",
      "mean_count_pot",
      "precip",
      "mrain",
      "mwd",
      "mws"
   )

# format lesion counts into integers
dat[, dbl] <- lapply(dat[, dbl], as.double)

# change distance to continuous variable
dat$dist <- as.numeric(gsub(" m", "", dat$distance))

# set factors
dat[, c("site", "distance", "rep")] <-
   lapply(dat[, c("site", "distance", "rep")], as.factor)

dat$SpEv <- as.factor(paste0(dat$site,dat$rep))

```




## Fit GAMs

### mod1 - s(Distance)

```{r fit-mod1}
mod1 <-
   gam(
      mean_count_pot ~ s(dist, k = 5),
      data = dat
   )

plot(mod1)

summary(mod1)
AIC(mod1)
```

The `k` value has to be set to 5, default is 10. Else the model will not fit due
to lack of degrees of freedom.

### mod2 - s(Distance) plus Precipitation 

```{r fit-mod2}
mod2 <-
   gam(
      mean_count_pot ~ rainfall + s(dist, k = 5),
      data = dat
   )

plot(mod2)

summary(mod2)
AIC(mod2)
```

The `k` value has to be set to 5, default is 10. Else the model will not fit due
to lack of degrees of freedom.


### mod3 - s(Distance and Windspeed) plus Precipitation

```{r fit-mod3}
mod3 <-
   gam(
      mean_count_pot ~ rainfall + s(dist + mws, k = 5),
      data = dat
   )

plot(mod3)

summary(mod3)
AIC(mod3)
```

mean wind speed looks like a linear term. move it out of the smoothing funtion.

Model looks the same as `mod2`

The `k` value has to be set to 3, default is 10. Else the model will not fit due
to lack of degrees of freedom.


### mod3 - s(Distance and Wind direction) plus Precipitation

```{r fit-mod4}
mod4 <-
   gam(
      mean_count_pot ~ rainfall + s(dist + mwd, k = 5),
      data = dat
   )

plot(mod4)

summary(mod4)
AIC(mod4)
```
Model gives warning; and is exactly the output same as `mod3` and `mod2`.  


```{r fit-mod5}
mod5 <-
   gam(
      mean_count_pot ~ rainfall + mws+ s(dist, k = 5),
      data = dat
   )

plot(mod5)

summary(mod5)
AIC(mod5)
```

```{r fit-mod6}
mod6 <-
   gam(
      mean_count_pot ~ SpEv+ s(dist, k = 5),
      data = dat
   )

plot(mod6)

summary(mod6)
AIC(mod6)
```


Lets compare all the models above
```{r}
AIC(mod1,mod2,mod3,mod4, mod5,mod6)

anova(mod1,mod2,mod3,mod4, mod5, mod6, test = "F")
```



## Thoughts

Examining the AIC, GCV and R^2 values, the best fitting model was `mod6`,
however this model does not explain the effect of windspeed or rainfall. 
We will proceed with `mod5` as the next best model which utilises both 
windspeed and rainfall as linear terms.
Adding wind direction does not improve the model suffiently to warrant inclusion;
especially considering we are not interested in this variable.  
