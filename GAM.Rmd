---
title: "Fit GAMs to dispersal patterns of _Ascochyta_ conidia"
author: "A.H. Sparks"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.width = 12, fig.height = 9) 
```

## Import Data

See "R/wrangle_raw_data.R" for the script that handles the data import. This
Rmd file focuses on the models themselves.

```{r libraries, message=FALSE, echo=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, broom, skimr, devtools, mgcv)

if (!require("theme.usq")) devtools::install_github("adamhsparks/theme.usq")
```

```{r import data, message=FALSE, echo=FALSE}
source("R/wrangle_raw_data.R")
```

## Fit GAMs

### mod1 - s(Distance)

```{r fit-mod1, echo=FALSE}
mod1 <-
   gam(
      mean_count_pot ~ s(dist, k = 5),
      data = dat
   )

summary(mod1)
```

### mod2 - s(Distance) plus Precipitation

```{r fit-mod2, echo=FALSE}
mod2 <-
   gam(
      mean_count_pot ~ sum_rain+ s(dist, k = 5),
      data = dat
   )

summary(mod2)
```

### mod3 - s(Distance) Windspeed
```{r fit-mod3, echo=FALSE}
mod3 <-
   gam(mean_count_pot ~ mws + s(dist, k = 5),
       data = dat)

summary(mod3)
```

### mod4 - s(Distance) Windspeed plus Precipitation
```{r fit-mod4, echo=FALSE}
mod4 <-
   gam(mean_count_pot ~ sum_rain + mws + s(dist, k = 5),
       data = dat)

summary(mod4)
```

### mod5 - s(Distance + Windspeed) plus Precipitation

```{r fit-mod5, echo=FALSE}
mod5 <-
   gam(
      mean_count_pot ~ sum_rain + s(dist + mws, k = 5),
      data = dat
   )

summary(mod5)
```

## Compare the Models

### AIC, BIC
```{r compare-mods, echo=FALSE}
models <- list(mod1 = mod1,
               mod2 = mod2,
               mod3 = mod3,
               mod4 = mod4,
               mod5 = mod5)
map_df(models, glance, .id = "model") %>%
   arrange(AIC)
```

### R^2^
```{r r2, echo=FALSE}
enframe(c(
   mod1 = summary(mod1)$r.sq,
   mod2 = summary(mod2)$r.sq,
   mod3 = summary(mod3)$r.sq,
   mod4 = summary(mod4)$r.sq,
   mod5 = summary(mod4)$r.sq
)) %>%
   arrange(desc(value))
```

### Coefficients

```{r coef, echo=FALSE}
cat("\nmod1\n")
coef(mod1)
cat("\nmod2\n")
coef(mod2)
cat("\nmod3\n")
coef(mod3)
cat("\nmod4\n")
coef(mod4)
cat("\nmod5\n")
coef(mod5)
```

### ANOVA
```{r anova, echo=FALSE}
anova(mod1, mod2, mod3, mod4, mod5, test = "F")
```

### Visualise the Models

```{r vis-mods, echo=FALSE}
par(mfrow = c(2, 2))
plot(mod1, main = "s(Distance)")
plot(mod2, main = "s(Distance) + Precipitation")
plot(mod3, main = "s(Distance) + Windspeed")
plot(mod4, main = "s(Distance) + Windspeed + Precipitation")
plot(mod5, main = "s(Distance + Windspeed) + Precipitation")
```
